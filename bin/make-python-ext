import cffi, glob, re
from os.path import join, dirname, abspath

BASE       = dirname(dirname(abspath(__file__)))
H_SOURCE   = open(join(BASE,"src/python/libparsing/_libparsing.h")).read()
C_SOURCE   = open(join(BASE,"src/python/libparsing/_libparsing.c")).read()
FFI_SOURCE = open(join(BASE,"src/python/libparsing/_libparsing.ffi")).read()

ffibuilder = cffi.FFI()
ffibuilder.set_source("_libparsing", H_SOURCE + C_SOURCE, extra_link_args=["-lpcre"])
ffibuilder.cdef(FFI_SOURCE)

if __name__ == "__main__":
	import sys, shutil
	args = sys.argv[1:]
	ffibuilder.compile(target="_libparsing.*", verbose=False, tmpdir=join(BASE,"build"))
	if args:
		shutil.copy("build/_libparsing.so", args[0])

# EOF - vim: syn=python ts=4 sw=4 noet
